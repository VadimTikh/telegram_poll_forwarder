# Инструкция по настройке и деплою Poll Forwarder

## Что делает разработчик

### 1. Получить Telegram API ключи

1. Откройте https://my.telegram.org
2. Войдите с номером телефона
3. Перейдите в **API development tools**
4. Создайте приложение (название и описание — любые)
5. Скопируйте **App api_id** и **App api_hash**

### 2. Настроить Twilio

1. Зарегистрируйтесь на https://www.twilio.com
2. В **Console** скопируйте **Account SID** и **Auth Token**
3. Перейдите в **Phone Numbers** → **Buy a number** (или используйте trial номер)
4. Скопируйте номер Twilio (формат `+1234567890`)

### 3. Верификация номера начальника

> Twilio trial аккаунт может звонить **только** на верифицированные номера.

1. В Twilio Console → **Phone Numbers** → **Verified Caller IDs**
2. Нажмите **Add a new Caller ID**
3. Введите номер телефона начальника (формат `+380...`)
4. Начальник получит звонок с кодом подтверждения

### 4. Настроить `.env` на сервере

Создайте файл `.env` в корне проекта:

```env
TG_API_ID=12345678
TG_API_HASH=abcdef1234567890abcdef1234567890

TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_PHONE_NUMBER=+1234567890

ADMIN_PASSWORD=надёжный_пароль_для_панели

PORT=3000
```

> **ADMIN_PASSWORD** — пароль для входа в веб-панель. Придумайте надёжный пароль и передайте начальнику.

### 5. Деплой на VPS

```bash
# Клонируйте репозиторий
git clone <url> poll-forwarder
cd poll-forwarder

# Установите зависимости
npm install

# Скомпилируйте
npm run build

# Создайте .env (см. выше)
nano .env

# Запустите через PM2
npm run pm2:start

# Проверьте логи
npm run pm2:logs
```

### 6. Настройка файрвола (опционально)

Если панель должна быть доступна по интернету:

```bash
# Откройте порт 3000 (или используйте nginx reverse proxy)
sudo ufw allow 3000
```

Рекомендуется использовать nginx + SSL для продакшена.

---

## Что делает начальник

### 1. Открыть панель

Перейдите по ссылке, которую дал разработчик:
`http://<ip-сервера>:3000`

### 2. Войти

Введите пароль, который дал разработчик.

### 3. Заполнить настройки

- **Telegram группа** — username (без @) или числовой ID группы для мониторинга
- **Куда пересылать** — оставьте `me` для пересылки в «Избранное», или укажите username/ID
- **Номер для звонка** — ваш номер в международном формате (`+380...`)
- **Кулдаун** — минимальный интервал между звонками в секундах

Нажмите **Сохранить настройки**.

### 4. Авторизовать Telegram

1. Нажмите **Авторизовать Telegram**
2. Дождитесь появления QR-кода
3. Откройте Telegram на телефоне
4. Перейдите: **Настройки** → **Устройства** → **Подключить устройство**
5. Сканируйте QR-код с экрана
6. Статус изменится на «Авторизован»

### 5. Запустить бота

Нажмите **Запустить**. Индикатор станет зелёным.

Бот начнёт мониторить указанную группу. При появлении нового опроса:
- Опрос будет переслан в указанный чат
- Вам поступит телефонный звонок

### 6. Остановить бота

Нажмите **Остановить** когда мониторинг не нужен.

---

## Решение проблем

| Проблема | Решение |
|---|---|
| Не удаётся войти в панель | Проверьте `ADMIN_PASSWORD` в `.env` |
| QR-код не появляется | Проверьте `TG_API_ID` и `TG_API_HASH` в `.env` |
| Бот не запускается | Проверьте что Telegram авторизован и настройки заполнены |
| Звонок не приходит | Проверьте верификацию номера в Twilio |
| Ошибка 2FA | Отключите двухфакторную авторизацию Telegram или авторизуйтесь через терминал |
